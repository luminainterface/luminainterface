# Redis configuration for Lumina
# ---------------------------------

# AOF persistence
appendonly yes
appendfsync everysec
appendfilename "appendonly.aof"
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Stream settings
stream-node-max-bytes 4mb
stream-node-max-entries 100

# Save after 15 minutes if at least 1 key changed
save 900 1
# Save after 5 minutes if at least 10 keys changed
save 300 10
# Save after 1 minute if at least 10000 keys changed
save 60 10000

# Memory management
maxmemory 2gb
maxmemory-policy allkeys-lru

# Logging
loglevel notice
logfile "/data/redis.log"

# Security
protected-mode yes
requirepass ${REDIS_PASSWORD:-changeme}

# Performance
io-threads 4
io-threads-do-reads yes 