groups:
- name: lumina-rules
  rules:
  # Redis lag
  - alert: RedisLagHigh
    expr: redis_stream_lag > 1000
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Redis stream lag high (>1k for 5 m)"
      description: "{{ $value }} pending messages in graph_stream"
      dashboard: "http://localhost:3001/d/redis/redis-overview?orgId=1&from=now-15m&to=now"

  # Planner latency
  - alert: PlannerP95High
    expr: histogram_quantile(0.95, rate(masterchat_plan_seconds_bucket[5m])) > 15
    for: 3m
    labels:
      severity: critical
    annotations:
      summary: "MasterChat planner latency p95 > 15 s"
      description: "Planning slow: {{ $value }} s"
      dashboard: "http://localhost:3001/d/masterchat/masterchat-overview?orgId=1&from=now-15m&to=now"

  # Crawler error rate
  - alert: CrawlerErrorSpike
    expr: rate(crawler_errors_total[5m]) / rate(crawler_pages_total[5m]) > 0.05
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Crawler error rate >5 %"
      description: "Errors per sec: {{ $value }}"
      dashboard: "http://localhost:3001/d/crawler/crawler-insights?orgId=1&from=now-15m&to=now" 